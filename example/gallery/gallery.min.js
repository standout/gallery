(function(a){var b=function(b){var c;var d=function(){c=e();f()};var e=function(){var b=a("<canvas/>").appendTo("body");if(b[0].getContext){a(window).resize(f)}else{b.remove();b=a("<div/>").appendTo("body").css({width:"100%",height:"100%",backgroundColor:"#000"})}return b.css({display:"none",top:0,left:0,zIndex:1e4,position:"fixed",opacity:0})};var f=function(){if(c[0].getContext){var b=a(window).width();var d=a(window).height();var e=c[0].getContext("2d");c.attr({width:b,height:d});var f=e.createRadialGradient(b/2,d/2,0,b/2,d/2,d*1.3);f.addColorStop(0,"rgba(0,0,0,0.25)");f.addColorStop(1,"#000");e.fillStyle=f;e.fillRect(0,0,b,d)}};this.showDark=function(){c.css("display","block").animate({opacity:.75},b.animationSpeed)};this.hideDark=function(){c.animate({opacity:0},b.animationSpeed,function(){c.css("display","none")})};d()};var c=function(c){var d=a("<div/>").css({display:"none",top:0,left:0,zIndex:10010,position:"fixed"}).attr("id","gallery_wrapper").appendTo("body");var e=a('<div class="options"><div class="left"></div><div class="close"></div><div class="right"></div></div>').css({display:"none",opacity:0});var f=a("<div/>").addClass("title");var g=a();var h=[];var i=false;var j,k,l,m;var n=function(){d.delegate("div","click",function(){switch(this.className){case"right":r(s);break;case"left":r(t);break;case"close":q();break}});a(document).delegate(c.selector,"click",function(){o(a(this));return false});a(window).resize(v);a(document).keydown(y);a(document).mousemove(z)};var o=function(e){i=true;k=x(e);j=h[k];if(c.hideEmbeds){a("iframe, embed, select").css("visibility","hidden")}b.showDark();d.css("display","block");w();u()};var p=function(){r(s)};var q=function(){i=false;if(c.hideEmbeds){a("iframe, embed, select").css("visibility","visible")}if(c.autoPlay){window.clearInterval(m)}b.hideDark();d.css("display","none");r()};var r=function(b){if(l){window.clearTimeout(l);j.wrapper.children(".options, .title").each(function(){a(this).animate({opacity:0},c.animationSpeed,function(){a(this).remove()})})}if(c.autoPlay){window.clearInterval(m)}j.wrapper.animate({opacity:0},c.animationSpeed,function(){j.wrapper.css("display","none");if(b){b()}})};var s=function(){k=h[k+1]?k+1:0;j=h[k];w();u()};var t=function(){k=h[k-1]?k-1:h.length-1;j=h[k];w();u()};var u=function(){if(l){window.clearTimeout(l)}if(c.autoPlay){m=window.setInterval(p,5e3)}j.wrapper.animate({opacity:1},c.animationSpeed);j.wrapper.append(e.clone());z();if(c.title&&j.trigger.attr("title")){j.wrapper.prepend(f.clone().text(j.trigger.attr("title")))}};var v=function(){w()};var w=function(){j.wrapper.css("display","block");if(!j.copy.data("width")){j.copy.data("width",j.copy.width());j.copy.data("height",j.copy.height())}var b=a(window).width();var d=a(window).height();var e=j.copy.data("width");var f=j.copy.data("height");if(e>b*c.maxSize||f>d*c.maxSize){e=b*c.maxSize;f=j.copy.data("height")/j.copy.data("width")*e;if(f>j.copy.data("height")*c.maxSize){f=d*c.maxSize;e=j.copy.data("width")/j.copy.data("height")*f}}j.wrapper.css({width:e,height:f,top:(d-f)*.5,left:(b-e)*.5});j.copy.css({width:e,height:f})};var x=function(b){return g.index(a(b))};var y=function(a){if(i){switch(a.which){case 39:r(s);break;case 37:r(t);break;case 27:q();break}}};var z=function(){if(i){var b=j.wrapper.children(".options");if(b.is(":hidden")){b.css("display","block").animate({opacity:1},c.animationSpeed)}if(l){window.clearTimeout(l)}l=window.setTimeout(function(){b.animate({opacity:0},c.animationSpeed,function(){a(this).css("display","none")})},2e3)}};var A=function(b){var c=a("<div><img/></div>").css({display:"none",opacity:0,position:"absolute","-ms-interpolation-mode":"bicubic"}).appendTo(d);c.children("img").attr("src",b.attr("href"));d.append(e);return c};this.setImage=function(a){g=g.add(a);var b=A(a);h.push({trigger:a,wrapper:b,copy:b.children("img")})};n()};a.fn.gallery=function(d){b=new b(a.extend({animationSpeed:200}),d);c=new c(a.extend({maxSize:.9,animationSpeed:200,selector:this.selector,title:false,hideEmbeds:false,autoPlay:false},d));return this.each(function(){c.setImage(a(this))})}})(jQuery)