(function(a){var b=function(b){var c;var d=function(){c=e();f()};var e=function(){var b=a("<canvas/>").appendTo("body");if(b[0].getContext){a(window).resize(f)}else{b.remove();b=a("<div/>").appendTo("body").css({width:"100%",height:"100%",backgroundColor:"#000"})}return b.css({display:"none",top:0,left:0,zIndex:1e4,position:"fixed",opacity:0})};var f=function(){if(c[0].getContext){var b=a(window).width();var d=a(window).height();var e=c[0].getContext("2d");c.attr({width:b,height:d});var f=e.createRadialGradient(b/2,d/2,0,b/2,d/2,d*1.3);f.addColorStop(0,"rgba(0,0,0,0.25)");f.addColorStop(1,"#000");e.fillStyle=f;e.fillRect(0,0,b,d)}};this.showDark=function(){c.css("display","block").animate({opacity:.75},b.animationSpeed)};this.hideDark=function(){c.animate({opacity:0},b.animationSpeed,function(){c.css("display","none")})};d()};var c=function(c){var d=a("<div/>").css({display:"none",top:0,left:0,zIndex:10010,position:"fixed"}).attr("id","gallery_wrapper").appendTo("body");var e=a('<div class="options"><div class="left"></div><div class="close"></div><div class="right"></div></div>').css({display:"none",opacity:0});var f=a("<div/>").addClass("title");var g=a();var h=[];var i;var j;var k=false;var l;var m=function(){d.delegate("div","click",function(){switch(this.className){case"right":p(q);break;case"left":p(r);break;case"close":o();break}});a(document).delegate(c.selector,"click",function(){n(a(this));return false});a(window).resize(t);a(document).keydown(w);a(document).mousemove(x)};var n=function(e){k=true;j=v(e);i=h[j];if(c.hideEmbeds){a("iframe, embed, select").css("visibility","hidden")}b.showDark();d.css("display","block");u();s()};var o=function(){k=false;if(c.hideEmbeds){a("iframe, embed, select").css("visibility","visible")}b.hideDark();d.css("display","none");p()};var p=function(b){if(l){window.clearTimeout(l);i.wrapper.children(".options, .title").each(function(){a(this).animate({opacity:0},c.animationSpeed,function(){a(this).remove()})})}i.wrapper.animate({opacity:0},c.animationSpeed,function(){i.wrapper.css("display","none");if(b){b()}})};var q=function(){j=h[j+1]?j+1:0;i=h[j];u();s()};var r=function(){j=h[j-1]?j-1:h.length-1;i=h[j];u();s()};var s=function(){if(l){window.clearTimeout(l)}i.wrapper.animate({opacity:1},c.animationSpeed);i.wrapper.append(e.clone());x();if(c.title&&i.trigger.attr("title")){i.wrapper.prepend(f.clone().text(i.trigger.attr("title")))}};var t=function(){u()};var u=function(){i.wrapper.css("display","block");if(!i.copy.data("width")){i.copy.data("width",i.copy.width());i.copy.data("height",i.copy.height())}var b=a(window).width();var d=a(window).height();var e=i.copy.data("width");var f=i.copy.data("height");if(e>b*c.maxSize||f>d*c.maxSize){e=b*c.maxSize;f=i.copy.data("height")/i.copy.data("width")*e;if(f>i.copy.data("height")*c.maxSize){f=d*c.maxSize;e=i.copy.data("width")/i.copy.data("height")*f}}i.wrapper.css({width:e,height:f,top:(d-f)*.5,left:(b-e)*.5});i.copy.css({width:e,height:f})};var v=function(b){return g.index(a(b))};var w=function(a){if(k){switch(a.which){case 39:p(q);break;case 37:p(r);break;case 27:o();break}}};var x=function(){if(k){var b=i.wrapper.children(".options");if(b.is(":hidden")){b.css("display","block").animate({opacity:1},c.animationSpeed)}if(l){window.clearTimeout(l)}l=window.setTimeout(function(){b.animate({opacity:0},c.animationSpeed,function(){a(this).css("display","none")})},2e3)}};var y=function(b){var c=a("<div><img/></div>").css({display:"none",opacity:0,position:"absolute","-ms-interpolation-mode":"bicubic"}).appendTo(d);c.children("img").attr("src",b.attr("href"));d.append(e);return c};this.setImage=function(a){g=g.add(a);var b=y(a);h.push({trigger:a,wrapper:b,copy:b.children("img")})};m()};a.fn.gallery=function(d){b=new b(a.extend({animationSpeed:200}),d);c=new c(a.extend({maxSize:.9,animationSpeed:200,selector:this.selector,title:false,hideEmbeds:false},d));return this.each(function(){c.setImage(a(this))})}})(jQuery)