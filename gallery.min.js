(function(b){var a=function(f){var d;var h=function(){d=g();e()};var g=function(){var i=b("<canvas/>").appendTo("body");if(i[0].getContext){b(window).resize(e)}else{i.remove();i=b("<div/>").appendTo("body").css({width:"100%",height:"100%",backgroundColor:"#000"})}return i.css({display:"none",top:0,left:0,zIndex:10000,position:"fixed",opacity:0})};var e=function(){if(d[0].getContext){var k=b(window).width();var i=b(window).height();var j=d[0].getContext("2d");d.attr({width:k,height:i});var l=j.createRadialGradient(k/2,i/2,0,k/2,i/2,i*1.3);l.addColorStop(0,"rgba(0,0,0,0.25)");l.addColorStop(1,"#000");j.fillStyle=l;j.fillRect(0,0,k,i)}};this.showDark=function(){d.css("display","block").animate({opacity:0.75},f.animationSpeed)};this.hideDark=function(){d.animate({opacity:0},f.animationSpeed,function(){d.css("display","none")})};h()};var c=function(q){var l=b("<div/>").css({display:"none",top:0,left:0,zIndex:10010,position:"fixed"}).attr("id","gallery_wrapper").appendTo("body");var i=b('<div class="options"><div class="left"></div><div class="close"></div><div class="right"></div></div>').css({display:"none",opacity:0});var o=[];var s;var m=false;var u;var t=function(){g();l.delegate("div","click",function(){switch(this.className){case"right":j(r);break;case"left":j(h);break;case"close":p();break}});q.element.delegate("a","click",function(){v(e(this));return false});b(window).resize(w);b(window).keydown(n);b(window).mousemove(f)};var v=function(y){m=true;s=y;a.showDark();l.css("display","block");k();d()};var p=function(){m=false;a.hideDark();l.css("display","none");j()};var j=function(y){if(u){window.clearTimeout(u);s.wrapper.children(".options").animate({opacity:0},q.animationSpeed,function(){b(this).css("display","none")})}s.wrapper.animate({opacity:0},q.animationSpeed,function(){s.wrapper.css("display","none");if(y){y()}})};var r=function(){var y=s.trigger.next().length?s.trigger.next():q.element.children("a").eq(0);s=e(y);k();d()};var h=function(){var y=q.element.children("a").index(s.trigger);s=y-1<0?o[o.length-1]:o[y-1];k();d()};var d=function(){if(u){window.clearTimeout(u)}s.wrapper.animate({opacity:1},q.animationSpeed);s.wrapper.append(i)};var w=function(){k()};var k=function(){s.wrapper.css("display","block");if(!s.copy.data("width")){s.copy.data("width",s.copy.width());s.copy.data("height",s.copy.height())}var z=b(window).width();var B=b(window).height();var A=s.copy.data("width");var y=s.copy.data("height");if(A>z*q.maxSize||y>B*q.maxSize){A=z*q.maxSize;y=(s.copy.data("height")/s.copy.data("width"))*A;if(y>s.copy.data("height")*q.maxSize){y=B*q.maxSize;A=(s.copy.data("width")/s.copy.data("height"))*y}}s.wrapper.css({width:A,height:y,top:(B-y)*0.5,left:(z-A)*0.5});s.copy.css({width:A,height:y})};var e=function(y){return o[q.element.children("a").index(b(y))]};var g=function(){q.element.children("a").each(function(){var y=x(b(this));o.push({trigger:b(this),wrapper:y,copy:y.children("img")})})};var x=function(y){var z=b("<div><img/></div>").css({display:"none",opacity:0,position:"absolute","-ms-interpolation-mode":"bicubic"}).appendTo(l);z.children("img").attr("src",y.attr("href"));l.append(i);return z};var n=function(y){if(m){switch(y.which){case 39:j(r);break;case 37:j(h);break;case 27:p();break}}};var f=function(){if(m){var y=s.wrapper.children(".options");if(y.is(":hidden")){y.css("display","block").animate({opacity:1},q.animationSpeed)}if(u){window.clearTimeout(u)}u=window.setTimeout(function(){y.animate({opacity:0},q.animationSpeed,function(){b(this).css("display","none")})},2000)}};t()};b.fn.gallery=function(d){a=new a(b.extend({animationSpeed:200}),d);return this.each(function(){new c(b.extend({element:b(this),maxSize:0.9,animationSpeed:200},d))})}})(jQuery);